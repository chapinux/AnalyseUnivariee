---
title: "Analyse Univariée (avec R)"
author: "PC - M2 IGAST"
date: "2019-2020"
output: ioslides_presentation
css : style.css
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,fig.width =6,fig.align="center", fig.height = 3)
library(knitr)
library(xtable)
library(ggplot2)
library(dplyr)
```

# Introduction générale 

## Reférences

- Cours M2 IGAST 2018 d'Ana-Maria Olteanu-Raimond 
- R et espace https://framabook.org/r-et-espace/
- Probabilités, analyse de données et statistiques , Gilbert Saporta, Editions TECHNIP, 2011
- Nombreuses ressources en ligne, e.g. : 
   http://www.foad-mooc.auf.org/IMG/pdf/424B_-Application_des_methodes_statistiques_d_analyse.pdf

## Deux familles statistiques

### Statistiques inférentielles
  A partir d'un échantillon , que peut-on attendre (inférer) de la population ?
  
  - Modèles, estimateurs, ... : **régression** , **estimation**, **extrapolation**
  - e.g. sondages, rencensement 

## Deux familles statistiques
  
### Statistiques descriptives 
  Pour décrire, résumer, synthétiser  les propriétés d'une **population** à partir de ses **individus** et des **variables** qui les décrivent.
  
  - Graphiques
  - Mesures (fréquences, distributions, moments) sur des variables
  - *Liaisons* statistiques entre variables : **corrélation**, **covariance**
  - classification , ACP,...

## Vocabulaire 
 
### Population
 **Ensemble** d'individus  
 
 "données", "corpus", "échantillon", "data"
 
### Individus
 **Unité** statistique **élémentaire**: personnes, logements, ...
 
 
  $\rightarrow$ "les lignes du tableau"

## Vocabulaire 

### Variables 
 **Caractéristiques, propriétés** d’un individu, mesurées par des enquêtes, des observations...

"les colonnes du tableau"  

- **Qualitatives** : facteurs e.g. Sexe, CSP, type , notion de **modalité**
 
- **Quantitatives** : nombres e.g. Taille, revenu, surface



<span style="color:red">&#9888;</span> **Valeurs** et **Nature** de données sont deux choses distinctes. 
<center> 3≠trois≠III </center>



 <span style="color:red">&#9888;</span> Valeurs manquantes  
 <center> NA , NaN, Null </center>





## Analyse univariée {.flexbox .vcenter}

**Décrire**  et **mesurer** la **répartition** des valeurs que peut prendre une variable.

On parle de **distributions** ($\approx$ "histogramme en continu")

Parfois certaines de ces répartitions s'approchent de  distributions bien connues (des **modèles**) : on parle de **lois**


e.g. loi normale/gaussienne , loi de Poisson

## Histogramme d'une variable suivant une loi normale $\mathscr{N}(0,1)$ 

```{r gaussienne1, cache=TRUE, fig.width=8, fig.height=3.5}
xx <- data.frame(value=rnorm(2600))
plot1 <- ggplot(xx)+
        geom_histogram(aes(x = value),bins = 50, color="#aaaaaa", fill="#44DD99" )+
        theme_light()
plot1
```


## Histogramme d'une distribution assymetrique à longue traîne.

```{r fat_tail1, cache=TRUE, fig.width=8, fig.height=3.5}
xx <- data.frame(value=rlnorm(2600,sdlog = 0.5))
plot1 <- ggplot(xx)+
        geom_histogram(aes(x = value),bins = 50, color="#aaaaaa", fill="#44DD99" )+
        theme_light()
plot1
```


## Les pièges de la statistique {.flexbox .vcenter}

> « Les statistiques ont une particularité majeure:
elles ne sont jamais les mêmes selon qu’elles sont avancées par un homme de gauche ou par un homme de droite.»


<div style="align:right;"> Jacques Mailhot</div>

## Les pièges de la statistique : exemple 1 


Dette 2013 = 100 milliards € 

Article de 2015 n°1 : « Diminution du déficit: La dette de la France, qui avait augmenté de 15 % l’an passé, n’a augmenté cette année que de 14%. Le gouvernement se félicite de sa gestion exemplaire.»  

Article de 2015 n°2 : « Augmentation du déficit: 15 milliard l’an passé, il dépasserait cette année 16 milliard €»

Qui dit la vérité? 




## Les pièges de la statistique:  exemple 2 


Sur les mêmes chiffres du bilan d’une entreprise en 2013 et 2014

* syndicats: «tous les salaires ont baissé de 10%»
* dirigeants:  «le salaire moyen a augmenté d’environ 18%»


|               |   Ouvriers    |           Cadres   |       
|:--------------|--------------:|-------------------:|
| 2013          | effectif : 500| effectif : 100      |
|               | salaire : 1300|  salaire :2200       |
| 2014          | effectif : 200           |        effectif :  400        |
|               | salaire :1170          | salaire :        1980       |



## Les précautions à prendre 

### Taille et représentativité de  l'échantillon

### Présences de groupes (paradoxe de Simpsons)


## Analyse univariée 

Objectif : **Décrire la répartition des valeurs** d'une variable

### Mesures de **tendance centrale**

mode, moyenne, médiane

### Mesures de **dispersion**

étendue, écart-type, variance, quantiles, coefficient de variation

### Mesures de **forme**

symétrie (Skewness) et aplatissement (Kurtosis) 
 




## Les variables (1)

### Données "non spatiales"" 

Les variables sont des valeurs attributaires d'individus, leurs localisation n'est pas prise en compte

### Données spatiales
  
  Individus restreints spatialement (**selection spatiale**), ou variables de **localisation** géographique (e.g. Lieu de résidence, coordonnées) renseignées pour les individus 
  
  
  
  quid des **distances** ? $\rightarrow$ modèle gravitaire , réseau etc.


## Variables **quantitatives**

Exemple ?

### variables quantitatives **continues** : $var \in \mathbb{R}$

Valeurs réelles,  toutes les valeurs de l'intervalle de mesures peuvent exister 

### variables quantitatives **discrètes**  : $var \in \mathbb{N}$ 

Valeurs entières, pour des attributs **dénombrables** (comptage) , 

parfois utilisées pour encoder une variable qualitative à 2 modalité e.g. présence (1) , absence(0)


## Variables **qualitatives**

Exemple ? 

<br>

les valeurs sont prises dans un ensemble **fini** de valeurs possibles, défini par **extension** (i.e. on donne la liste des valeurs possibles)


$\rightarrow$ notion de **modalités** 

## Variables **qualitatives**


### variables qualitatives **nominales**

Les modalités ne sont **pas ordonnées** explicitement 

e.g. situation matrimoniale $\in$ {marié·e, célibataire, veuf·ve}

### variables qualitatives **ordinales**

Les modalités sont **ordonnées** selon un ordre **total** et non-ambigu. 

e.g. Echelle de Likert (5 ou 7 valeurs, dont une neutre)

satisfaction $\in$ {Très satisfait, Satisfait, Ni satisfait ni insatisfait, Peu satisfait, Pas du tout satisfait}


## l'Échelle d’Analyse


Spécificité de la statistique spatiale : à quelle échelle observe-t'on une donnée ?

«Problème insoluble» : le MAUP (Modifiable Areal Unit Problem)

###  Unités spatiales agrégées 

agrégation d’unités spatiales : comtés, départements, régions, pays

e.g. Comprendre comment  le taux de chômage d’un pays est distribué entre les régions pour guider les politiques économiques

### Groupe d’unités spatiales: 

identification des unités spatiales ayant des caractéristiques semblables

e.g. IRIS



## Echelle d’analyse individuelle Vs Echelle d’analyse agrégée 


  Inférer à partir de l’analyse de données agrégées des caractéristiques individuelles **Désagrégation** ou  **Ventilation** 


Inférer des caractéristiques concernant les unités agrégées d’après les caractéristiques individuelles: **Agrégation** 


<span style="color:red">&#9888;</span>pas toujours possible et pas immédiat !<span style="color:red">&#9888;</span>

## le MAUP (Modifibale Aereal Unit Problème)

Problème d'agrégation spatiale : les résultas d'une analyse statistique spatiale dépendent du choix d'agragation 

biais «sytématique et insoluble» 

TODO trouver un exemple carto genre vote 

# Statistiques descriptives univariées : la tendance

## Moyenne

### Moyenne

$\displaystyle \bar{x} = \frac{1}{n}\sum_{i=0}^{n} x_i$


### Moyenne pondérée

Lors que les valeurs n'ont pas le même poids (e.g. poids = effectif de la valeur)

$\displaystyle \bar{x} = \frac{1}{\sum_{i=0}^n pi}\sum_{i=0}^{n} p_i x_i$


## Avantages et inconvénients de la moyenne

### Avantage
  Chaque valeur compte

### Inconvénients 

* sensibilité aux valeurs extrèmes 
* pas de signification sur les valeurs discrètes (e.g. 2.5 enfants par femme)


$\rightarrow$ exclure les outliers<br>
$\rightarrow$ utiliser un autre estimateur<br>
$\rightarrow$ étudier la distribution des valeurs (e.g. cas bimodal) et opérer une classification




## Autres Moyennes


### Moyenne geométrique:
<br>

$\displaystyle \bar{x} = \sqrt[n]{\prod _{i=0}^{n} x_i}$  

Moins sensible à la présence de valeurs extrèmes

### Moyenne quadratique (RMS) 
<br>

$\displaystyle \bar{x} = \sqrt{\frac{1}{n}\prod _{i=0}^{n} x_i}$


## Moyennes glissantes

Moyenne calculée sur une fenètre de $n$ valeurs consécutives.

e.g. on reçoit une mesure chaque seconde, très bruitée, et on désire afficher 10 minutes de signal lissé dans le temps

 $\rightarrow$ on calcule pour chaque point du signal, la moyenne sur 10 valeurs consécutives (5 en avant , 5 en arrière)


## le Mode {.flexbox .vcenter}

**Mode** :  valeur la plus fréquente (effectif max.) de la série de valeurs que prend une variable.
<br>
<br>
<span style="color:red">&#9888;</span> si variable quantitative continue<span style="color:red">&#9888;</span>

$\rightarrow$ nécessite une classification préalable

Dans ce cas le mode est la moyenne des valeurs min et max des bornes de la classe de plus grand effectif.

## Avantages et inconvénients du mode

### Avantages 
Peu sensible aux valeurs extrêmes (moins sensible que la moyenne)
Signification concrète : la situation la plus fréquente

### Inconvénients 
Ne dépends pas de toutes les observations : la modification d'une seule valeur n’entraine pas une modification du mode

## la Médiane 

**Médiane** : valeur qui partage une série de valeurs en deux sous-ensembles d’égal effectif

Comme en géométrie, la médiane est la valeur de la variable qui est la plus proche de toutes les autres.

### Etapes de calcul 
Ordonner les valeurs selon un ordre croissant

Calculer le rang $i=\frac{n+1}{2}$$

si $n$ impair, la valeur médiane existe dans la série statistique

si $n$ pair, la valeur médiane est entre deux valeurs et est égale à la moyenne de ces deux valeurs


## Avantages et inconvénients de la médiane 

### Avantages 
Plus pertinente que la moyenne

Peu sensible aux valeurs extrêmes 

A une signification concrète : qui divise en deux la distribution : un individu sur deux a une valeur inférieure ou supérieure à celle-ci

### Inconvénient 
Ne dépend pas de toutes les observations : la modification d'une seule valeur n’entraine pas une modification de la médiane 


## Quelle mesure choisir ?

Tout dépend de la distribution ! 

$\rightarrow$ **Toujours** afficher l'histogramme ou la distribution de densité
<br><br>

Le **mode** est privilégié pour les valeurs **nominales** et si on désire considérer «le cas le plus fréquent»

Distributions de variables continues sans longues traines ? <br>
$\rightarrow$ moyenne et médiane

Plusieurs modes dans la distribution ?<br>
$\rightarrow$ classification puis mediane / moyenne par classe


## Distribution bimodale 

```{r bimod1, cache=TRUE, fig.width=8, fig.height=3.5}
xx <- data.frame(value=rnorm(1600,mean = 5, sd = 1))
yy <- data.frame(value= rnorm(1400, mean = 10, sd=2) )
xx <-  rbind(xx, yy)
plot1 <- ggplot(xx)+
        geom_line(aes(x = value),stat = "density", color="#44DD99", lwd= 1.3)+
        geom_vline(xintercept = mean(xx$value), color="red")+
        geom_vline(xintercept = median(xx$value),color="blue")+
        annotate("text", x=c(8,5.5), y=c(0.2,0.2), colour=c("red","blue"),label=c("mean", "median"))+
        theme_light()
plot1
```




## Distribution unimodale symétrique 

```{r gaussienne2, cache=TRUE, fig.width=8, fig.height=3.5}
xx <- data.frame(value=rnorm(2900,mean = 5, sd = 1))
plot1 <- ggplot(xx)+
        geom_line(aes(x = value),stat = "density", color="#44DD99", lwd= 1.3)+
        geom_vline(xintercept = mean(xx$value), color="red")+
        geom_vline(xintercept = median(xx$value) + 0.02,color="blue")+
        annotate("text", x=c(4.5,5.5), y=c(0.2,0.2), colour=c("red","blue"),label=c("mean", "median"))+
        theme_light()
plot1
```


# Statistiques descriptives univariées : la dispersion

## La dispersion statistique 

Tendance des valeurs d'une variable à se disperser autour des valeurs des tendances centrales.

Exemple :  deux variables X et Y, $\sim\mathscr{N}(0,1)$

```{r gaussienne2D, cache=TRUE}
mydataset <- data.frame(X=rnorm(900), Y=rnorm(900))
plot1 <- ggplot(mydataset)+
        geom_point(aes(x = X, y=Y), fill="#44DD99", color="#666666", shape=21)+
        coord_equal()+theme_light()
plot1
```


## Variance et Écart-type

La **variance** est la somme des écarts carrés à la moyenne

$\displaystyle var_X= \frac{1}{n}\sum_{i=1}^{n}(x_i -\bar{x})^2$

Avec :
  
  * $X$ une variable
  * $x_i$ les valeurs de la variables
  * $\bar{x}$ la moyenne de $X$ 
  * $n$ l'effectif

$\sigma_X = \sqrt{var_X}$  : l'**écart type** est la racine carrée de la variance

## Variance et Écart-type

Variance et écart-type rendent compte de la **dispersion** de la variable autour de sa moyenne.

Ils sont **sensibles** aux valeurs extrèmes et toujours **positifs**.

Si $var_X = 0$ ou $\sigma_X = 0$ , alors $X$ est **constante**.

Un écart-type faible indique que les valeurs sont réparties de façon **homogène** autour de la moyenne.

## Mise en garde {.flexbox .vcenter}

<span style="color:red; font-size:1.5em;">&#9888;</span><span style="font-size:1.3em;">Variance et écart type n'ont d'intérêt que pour qualifier des distributions **unimodales**, et (à peu près) **symétriques**</span> <span style="color:red;font-size:1.5em;">&#9888;</span>

(i.e. proche de la Gaussienne)


## Lorsque $X \sim \mathscr{N}(\mu,\sigma) $

```{r stddev1, cache=TRUE}
X <- data.frame(value=rnorm(1900))
plot1 <- ggplot(X)+
        geom_line(aes(x = value),stat="density", color="#44DD99", lwd=1.2)+
        geom_vline(xintercept = c(-sd(X$value), sd(X$value)), color="red")+
        geom_vline(xintercept = c(-2*sd(X$value), 2*sd(X$value)), color="blue")+
        annotate("text", x=c(3.5,3.5), y=c(0.2,0.15), colour=c("red","blue"),label=c("  68,27 % ","95,45 % "))+
        theme_light()
plot1
```


## Quantiles


# Statistiques descriptives univariées : la forme

## Construction de la distribution théorique.

On commence par sommer les effectifs selon les modalités (en ligne et en colonne)

$$\begin{array}{c|c|c|c}
   & blanc & noir & \texttt{total}\\ 
   \hline
carré &  22 &   12 & 34\\ 
  \hline
  rond &   10 &  30 &  40  \\ 
    \hline
  triangle &  26 &   5 &  31\\
  \hline
  \texttt{total} & 58 & 47 & 105
  \end{array}$$

On appelle les sommes en lignes et en colonnes **sommes marginales**, elles sont mises dans les "marges" du tableau.








